{% extends 'base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css">
<style>
    #hazard-map { height: 500px; width: 100%; border-radius: 8px; }
    .risk-high { color: #FF3B30; font-weight: bold; }
    .risk-medium { color: #FF9500; font-weight: 500; }
    .risk-low { color: #00A651; font-weight: 500; }
    .sustainability-score {
        width: 80px; height: 80px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.75rem; font-weight: 700;
        margin: 0 auto 1rem; color: white;
    }
    .score-a { background-color: #00A651; }
    .score-b { background-color: #4CD964; }
    .score-c { background-color: #4A90E2; }
    /* Add other styles from your original file if needed */
    :root { --bs-primary: #0d6efd; }
</style>
{% endblock %}

{% block content %}
<section class="bg-light py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="mb-3">{{ page_title }}</h1> {# page_title from context #}
                <p class="lead mb-4">Access comprehensive reports on environmental risks, hazardous events, and sustainability metrics.</p>
            </div>
        </div>
    </div>
</section>

<section class="py-4">
    <div class="container">
        <ul class="nav nav-pills nav-justified mb-4" id="hazardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="hazard-map-tab" data-bs-toggle="pill" data-bs-target="#hazard-map-content" type="button" role="tab">Hazard Map</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sustainability-tab" data-bs-toggle="pill" data-bs-target="#sustainability-content" type="button" role="tab">Sustainability Reports</button>
            </li>
        </ul>
        
        <div class="tab-content" id="hazardTabsContent">
            <div class="tab-pane fade show active" id="hazard-map-content" role="tabpanel">
                <div id="hazard-map"></div>
            </div>
            <div class="tab-pane fade" id="sustainability-content" role="tabpanel">
                <div class="row mb-4">
                    {% if hazard_reports %}
                        {% for report in hazard_reports %}
                        <div class="col-md-4 mb-4">
                            <div class="card h-100 report-card">
                                <div class="card-body text-center">
                                    <div class="sustainability-score score-{{ report.score_grade|lower }}">{{ report.score_grade }}</div>
                                    <h4 class="card-title">{{ report.district_name }}</h4>
                                    <p class="card-text">{{ report.summary }}</p>
                                    <div class="mt-3"><a href="{{ report.full_report_link }}" class="btn btn-outline-primary">View Report</a></div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="col-12"><p>No sustainability reports available.</p></div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const hazardMapElement = document.getElementById('hazard-map');
        if (hazardMapElement) {
            const hazardMap = L.map('hazard-map').setView([40.7128, -74.0060], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(hazardMap);
        }
        // Add JS for other charts if needed, ensuring data comes from context or is static
    });
</script>
{% endblock %}
