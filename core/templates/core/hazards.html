{% extends 'base.html' %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css">
<style>
    #hazard-map { height: 500px; width: 100%; border-radius: 8px; }
    .risk-high { color: #FF3B30; font-weight: bold; }
    .risk-medium { color: #FF9500; font-weight: 500; }
    .risk-low { color: #00A651; font-weight: 500; }
    .sustainability-score {
        width: 80px; height: 80px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        font-size: 1.75rem; font-weight: 700;
        margin: 0 auto 1rem; color: white;
    }
    .score-a { background-color: #00A651; }
    .score-b { background-color: #4CD964; }
    .score-c { background-color: #4A90E2; }
    .score-d { background-color: #FF9500; }
    .score-f { background-color: #FF3B30; }
    .report-card { transition: transform 0.3s ease; }
    .report-card:hover { transform: translateY(-5px); }
    .nav-pills .nav-link.active { background-color: var(--bs-primary); }
    .progress-bar-success { background-color: #00A651; }
    .progress-bar-warning { background-color: #FF9500; }
    .progress-bar-danger { background-color: #FF3B30; }
    :root { --bs-primary: #0d6efd; }
</style>
{% endblock %}

{% block content %}
<section class="bg-light py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="mb-3">{{ page_title }}</h1>
                <p class="lead mb-4">Access comprehensive reports on environmental risks, hazardous events, and sustainability metrics to make informed urban development decisions.</p>
            </div>
        </div>
    </div>
</section>

<section class="py-4">
    <div class="container">
        <ul class="nav nav-pills nav-justified mb-4" id="hazardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="hazard-map-tab" data-bs-toggle="pill" data-bs-target="#hazard-map-content" type="button" role="tab" aria-controls="hazard-map-content" aria-selected="true">
                    <i class="bi bi-map me-2"></i>Hazard Map
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sustainability-tab" data-bs-toggle="pill" data-bs-target="#sustainability-content" type="button" role="tab" aria-controls="sustainability-content" aria-selected="false">
                    <i class="bi bi-leaf me-2"></i>Sustainability Reports
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="historical-tab" data-bs-toggle="pill" data-bs-target="#historical-content" type="button" role="tab" aria-controls="historical-content" aria-selected="false">
                    <i class="bi bi-clock-history me-2"></i>Historical Events
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="projections-tab" data-bs-toggle="pill" data-bs-target="#projections-content" type="button" role="tab" aria-controls="projections-content" aria-selected="false">
                    <i class="bi bi-graph-up me-2"></i>Future Projections
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="hazardTabsContent">
            <div class="tab-pane fade show active" id="hazard-map-content" role="tabpanel" aria-labelledby="hazard-map-tab">
                <div class="row">
                    <div class="col-lg-3 mb-4">
                        <div class="card"><div class="card-body">
                            <h5 class="card-title mb-3">Hazard Filters</h5>
                            <div class="mb-3">
                                <label class="form-label">Hazard Types</label>
                                <div class="form-check"><input class="form-check-input" type="checkbox" id="flood-hazard" checked><label class="form-check-label" for="flood-hazard">Flood Zones</label></div>
                                <div class="form-check"><input class="form-check-input" type="checkbox" id="fire-hazard" checked><label class="form-check-label" for="fire-hazard">Fire Risk</label></div>
                            </div>
                            <button class="btn btn-primary w-100" id="apply-hazard-filters">Apply</button>
                        </div></div>
                    </div>
                    <div class="col-lg-9"><div class="card mb-4"><div class="card-body p-0"><div id="hazard-map"></div></div></div></div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="sustainability-content" role="tabpanel" aria-labelledby="sustainability-tab">
                <div class="row mb-4"><div class="col-lg-8 mx-auto text-center"><h3>Urban Sustainability Reports</h3></div></div>
                <div class="row mb-4">
                    {% if hazard_reports %}
                        {% for report in hazard_reports %}
                        <div class="col-md-4 mb-4">
                            <div class="card h-100 report-card">
                                <div class="card-body text-center">
                                    <div class="sustainability-score score-{{ report.score_grade|lower }}">{{ report.score_grade }}</div>
                                    <h4 class="card-title">{{ report.district_name }}</h4>
                                    <p class="card-text">{{ report.summary }}</p>
                                    <div class="mt-3"><a href="{{ report.full_report_link }}" class="btn btn-outline-primary">View Report</a></div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="col-12"><p>No sustainability reports available.</p></div>
                    {% endif %}
                </div>
            </div>
            <div class="tab-pane fade" id="historical-content" role="tabpanel" aria-labelledby="historical-tab"></div>
            <div class="tab-pane fade" id="projections-content" role="tabpanel" aria-labelledby="projections-tab">
                 <div class="row mb-4">
                    <div class="col-lg-6 mb-4"><div class="card h-100"><div class="card-body">
                        <h4 class="card-title">Climate Impact Projections</h4>
                        <div class="chart-container mt-4"><canvas id="climateChart" height="250"></canvas></div>
                    </div></div></div>
                    <div class="col-lg-6 mb-4"><div class="card h-100"><div class="card-body">
                        <h4 class="card-title">Infrastructure Vulnerability Forecast</h4>
                        <div class="chart-container mt-4"><canvas id="infrastructureChart" height="250"></canvas></div>
                    </div></div></div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const hazardMapElement = document.getElementById('hazard-map');
        if (hazardMapElement) {
            const hazardMap = L.map('hazard-map').setView([40.7128, -74.0060], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(hazardMap);
        }
        const climateCtx = document.getElementById('climateChart');
        if (climateCtx) {
            new Chart(climateCtx.getContext('2d'), {type: 'line', data: { labels: ['2025', '2050'], datasets: [{ label: 'Avg Temp (°C)', data: [15.2, 17.5], borderColor: '#FF3B30', fill: false }]}});
        }
        const infraCtx = document.getElementById('infrastructureChart');
        if (infraCtx) {
            new Chart(infraCtx.getContext('2d'), {type: 'bar', data: { labels: ['Stormwater', 'Electrical'], datasets: [{ label: 'Vulnerability (%)', data: [25,30], backgroundColor: '#4A90E2' }]}});
        }
    });
</script>
{% endblock %}
