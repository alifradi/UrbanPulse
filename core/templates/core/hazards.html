{% extends 'core/base.html' %}

{% block title %}{{ page_title|default:"Hazard Analysis & Sustainability - UrbanPulse" }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css">
<style>
    #hazard-map {
        height: 500px;
        width: 100%;
        border-radius: 8px;
    }
    .risk-high {
        color: #FF3B30;
        font-weight: bold;
    }
    .risk-medium {
        color: #FF9500;
        font-weight: 500;
    }
    .risk-low {
        color: #00A651; /* Updated to match legend, was #34C759 */
        font-weight: 500;
    }
    .sustainability-score {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        font-weight: 700;
        margin: 0 auto 1rem;
        color: white;
    }
    .score-a {
        background-color: #00A651; /* Updated to match legend, was #34C759 */
    }
    .score-b {
        background-color: #4CD964;
    }
    .score-c {
        background-color: #4A90E2; /* Updated to match legend, was #5AC8FA */
    }
    .score-d {
        background-color: #FF9500;
    }
    .score-f {
        background-color: #FF3B30;
    }
    .report-card {
        transition: transform 0.3s ease;
    }
    .report-card:hover {
        transform: translateY(-5px);
    }
    .nav-pills .nav-link.active {
        background-color: var(--bs-primary); /* Using Bootstrap variable for consistency, was --deep-blue */
    }
    .progress-bar-success {
        background-color: #00A651; /* Was --vibrant-green */
    }
    .progress-bar-warning {
        background-color: #FF9500;
    }
    .progress-bar-danger {
        background-color: #FF3B30;
    }
    /* Ensure CSS variables are defined if not using Bootstrap's default, or use direct hex codes */
    :root {
        --bs-primary: #0d6efd; /* Example Bootstrap primary color */
    }
</style>
{% endblock %}

{% block content %}
<section class="bg-light py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="mb-3">{{ page_title|default:"Hazard Analysis & Sustainability" }}</h1>
                <p class="lead mb-4">Access comprehensive reports on environmental risks, hazardous events, and sustainability metrics to make informed urban development decisions.</p>
            </div>
          </div>
    </div>
</section>

<section class="py-4">
    <div class="container">
        <ul class="nav nav-pills nav-justified mb-4" id="hazardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="hazard-map-tab" data-bs-toggle="pill" data-bs-target="#hazard-map-content" type="button" role="tab" aria-controls="hazard-map-content" aria-selected="true">
                    <i class="bi bi-map me-2"></i>Hazard Map
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="sustainability-tab" data-bs-toggle="pill" data-bs-target="#sustainability-content" type="button" role="tab" aria-controls="sustainability-content" aria-selected="false">
                    <i class="bi bi-leaf me-2"></i>Sustainability Reports
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="historical-tab" data-bs-toggle="pill" data-bs-target="#historical-content" type="button" role="tab" aria-controls="historical-content" aria-selected="false">
                    <i class="bi bi-clock-history me-2"></i>Historical Events
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="projections-tab" data-bs-toggle="pill" data-bs-target="#projections-content" type="button" role="tab" aria-controls="projections-content" aria-selected="false">
                    <i class="bi bi-graph-up me-2"></i>Future Projections
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="hazardTabsContent">
            <div class="tab-pane fade show active" id="hazard-map-content" role="tabpanel" aria-labelledby="hazard-map-tab">
                <div class="row">
                    <div class="col-lg-3 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Hazard Filters</h5>
                                
                                <div class="mb-3">
                                    <label class="form-label">Hazard Types</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="flood-hazard" checked>
                                        <label class="form-check-label" for="flood-hazard">Flood Zones</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="fire-hazard" checked>
                                        <label class="form-check-label" for="fire-hazard">Fire Risk Areas</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="earthquake-hazard" checked>
                                        <label class="form-check-label" for="earthquake-hazard">Seismic Activity</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="pollution-hazard" checked>
                                        <label class="form-check-label" for="pollution-hazard">Air Quality Concerns</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="infrastructure-hazard" checked>
                                        <label class="form-check-label" for="infrastructure-hazard">Infrastructure Vulnerabilities</label>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Risk Level</label>
                                    <select class="form-select" id="risk-level">
                                        <option value="all">All Risk Levels</option>
                                        <option value="high">High Risk Only</option>
                                        <option value="medium">Medium Risk & Above</option>
                                        <option value="low">Low Risk & Above</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Time Period</label>
                                    <select class="form-select" id="time-period">
                                        <option value="current">Current Assessment</option>
                                        <option value="5year">5-Year Projection</option>
                                        <option value="10year">10-Year Projection</option>
                                        <option value="historical">Historical Data</option>
                                    </select>
                                </div>
                                
                                <button class="btn btn-primary w-100" id="apply-hazard-filters">Apply Filters</button>
                                <button class="btn btn-outline-secondary w-100 mt-2" id="reset-hazard-filters">Reset</button>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Legend</h5>
                                <div class="d-flex align-items-center mb-2">
                                    <div style="width: 20px; height: 20px; background-color: #FF3B30; border-radius: 50%;"></div>
                                    <span class="ms-2">High Risk</span>
                                </div>
                                <div class="d-flex align-items-center mb-2">
                                    <div style="width: 20px; height: 20px; background-color: #FF9500; border-radius: 50%;"></div>
                                    <span class="ms-2">Medium Risk</span>
                                </div>
                                <div class="d-flex align-items-center mb-2">
                                    <div style="width: 20px; height: 20px; background-color: #FFCC00; border-radius: 50%;"></div>
                                    <span class="ms-2">Low Risk</span>
                                </div>
                                <div class="d-flex align-items-center">
                                    <div style="width: 20px; height: 20px; background-color: #00A651; border-radius: 50%;"></div> {# Updated to match .risk-low and .score-a #}
                                    <span class="ms-2">Minimal Risk</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-9">
                        <div class="card mb-4">
                            <div class="card-body p-0">
                                <div id="hazard-map"></div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Selected Area Analysis</h5>
                                <p class="card-text text-muted">Click on the map to select an area for detailed hazard analysis.</p>
                                
                                <div id="area-analysis" style="display: none;">
                                    <h6 class="mt-4 mb-3">Downtown District</h6>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h6 class="mb-2">Flood Risk</h6>
                                            <div class="progress mb-3" style="height: 20px;">
                                                <div class="progress-bar progress-bar-warning" role="progressbar" style="width: 65%;" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100">65%</div>
                                            </div>
                                            
                                            <h6 class="mb-2">Fire Risk</h6>
                                            <div class="progress mb-3" style="height: 20px;">
                                                <div class="progress-bar progress-bar-success" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
                                            </div>
                                            
                                            <h6 class="mb-2">Seismic Risk</h6>
                                            <div class="progress mb-3" style="height: 20px;">
                                                <div class="progress-bar progress-bar-success" role="progressbar" style="width: 15%;" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100">15%</div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-md-6">
                                            <h6 class="mb-2">Air Quality Risk</h6>
                                            <div class="progress mb-3" style="height: 20px;">
                                                <div class="progress-bar progress-bar-warning" role="progressbar" style="width: 55%;" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100">55%</div>
                                            </div>
                                            
                                            <h6 class="mb-2">Infrastructure Risk</h6>
                                            <div class="progress mb-3" style="height: 20px;">
                                                <div class="progress-bar progress-bar-danger" role="progressbar" style="width: 75%;" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">75%</div>
                                            </div>
                                            
                                            <h6 class="mb-2">Overall Risk</h6>
                                            <div class="progress mb-3" style="height: 20px;">
                                                <div class="progress-bar progress-bar-warning" role="progressbar" style="width: 60%;" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100">60%</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <h6>Risk Factors</h6>
                                        <ul>
                                            <li>Located in 100-year flood plain with inadequate drainage infrastructure</li>
                                            <li>Aging electrical grid with documented safety concerns</li>
                                            <li>Air quality concerns due to proximity to industrial zone</li>
                                            <li>Limited evacuation routes in emergency scenarios</li>
                                        </ul>
                                        
                                        <h6>Mitigation Recommendations</h6>
                                        <ul>
                                            <li>Infrastructure upgrades to improve drainage and flood control</li>
                                            <li>Electrical system modernization and safety improvements</li>
                                            <li>Implementation of green spaces to improve air quality</li>
                                            <li>Development of comprehensive emergency response plan</li>
                                        </ul>
                                        
                                        <div class="text-end mt-3">
                                            <a href="#" class="btn btn-primary">Download Full Report</a> {# Placeholder link #}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="sustainability-content" role="tabpanel" aria-labelledby="sustainability-tab">
                <div class="row mb-4">
                    <div class="col-lg-8 mx-auto text-center">
                        <h3>Urban Sustainability Reports</h3>
                        <p class="lead text-muted">Comprehensive analysis of sustainability metrics across urban districts, including green energy installations, environmental impact, and future projections.</p>
                    </div>
                </div>
                
                <div class="row mb-4">
                    {# Loop through hazard_reports from context if available #}
                    {% if hazard_reports %}
                        {% for report in hazard_reports %}
                        <div class="col-md-4 mb-4">
                            <div class="card h-100 report-card">
                                <div class="card-body text-center">
                                    <div class="sustainability-score score-{{ report.score_grade|default:'a'|lower }}">{{ report.score_grade|default:'A' }}</div>
                                    <h4 class="card-title">{{ report.district_name|default:"District Name" }}</h4>
                                    <p class="card-text">{{ report.summary|default:"Sustainability summary." }}</p>
                                    <hr>
                                    <div class="row text-start">
                                        <div class="col-6">
                                            <p class="mb-1"><strong>Green Buildings:</strong></p>
                                            <p class="mb-1"><strong>Solar Capacity:</strong></p>
                                            <p class="mb-1"><strong>EV Charging:</strong></p>
                                            <p class="mb-1"><strong>Public Transit:</strong></p>
                                            <p class="mb-1"><strong>Waste Recycling:</strong></p>
                                        </div>
                                        <div class="col-6 text-end">
                                            <p class="mb-1">{{ report.green_buildings_pct|default:"N/A" }}%</p>
                                            <p class="mb-1">{{ report.solar_capacity_mw|default:"N/A" }} MW</p>
                                            <p class="mb-1">{{ report.ev_stations_count|default:"N/A" }} Stations</p>
                                            <p class="mb-1">{{ report.public_transit_rating|default:"N/A" }}</p>
                                            <p class="mb-1">{{ report.waste_recycling_pct|default:"N/A" }}%</p>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <a href="{{ report.full_report_link|default:'#' }}" class="btn btn-outline-primary">View Full Report</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 report-card">
                            <div class="card-body text-center">
                                <div class="sustainability-score score-a">A</div>
                                <h4 class="card-title">Downtown District</h4>
                                <p class="card-text">Leading sustainability initiatives with extensive green building adoption and renewable energy integration.</p>
                                <hr>
                                <div class="row text-start">
                                    <div class="col-6">
                                        <p class="mb-1"><strong>Green Buildings:</strong></p>
                                        <p class="mb-1"><strong>Solar Capacity:</strong></p>
                                        <p class="mb-1"><strong>EV Charging:</strong></p>
                                        <p class="mb-1"><strong>Public Transit:</strong></p>
                                        <p class="mb-1"><strong>Waste Recycling:</strong></p>
                                    </div>
                                    <div class="col-6 text-end">
                                        <p class="mb-1">85%</p>
                                        <p class="mb-1">12.5 MW</p>
                                        <p class="mb-1">245 Stations</p>
                                        <p class="mb-1">Excellent</p>
                                        <p class="mb-1">78%</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a href="#" class="btn btn-outline-primary">View Full Report</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 report-card">
                            <div class="card-body text-center">
                                <div class="sustainability-score score-b">B</div>
                                <h4 class="card-title">North District</h4>
                                <p class="card-text">Strong sustainability performance with ongoing improvements in renewable energy and transportation.</p>
                                <hr>
                                <div class="row text-start">
                                    <div class="col-6">
                                        <p class="mb-1"><strong>Green Buildings:</strong></p>
                                        <p class="mb-1"><strong>Solar Capacity:</strong></p>
                                        <p class="mb-1"><strong>EV Charging:</strong></p>
                                        <p class="mb-1"><strong>Public Transit:</strong></p>
                                        <p class="mb-1"><strong>Waste Recycling:</strong></p>
                                    </div>
                                    <div class="col-6 text-end">
                                        <p class="mb-1">72%</p>
                                        <p class="mb-1">8.3 MW</p>
                                        <p class="mb-1">178 Stations</p>
                                        <p class="mb-1">Good</p>
                                        <p class="mb-1">65%</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a href="#" class="btn btn-outline-primary">View Full Report</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 report-card">
                            <div class="card-body text-center">
                                <div class="sustainability-score score-c">C</div>
                                <h4 class="card-title">Industrial Zone</h4>
                                <p class="card-text">Moderate sustainability with significant improvement opportunities in emissions and energy efficiency.</p>
                                <hr>
                                <div class="row text-start">
                                    <div class="col-6">
                                        <p class="mb-1"><strong>Green Buildings:</strong></p>
                                        <p class="mb-1"><strong>Solar Capacity:</strong></p>
                                        <p class="mb-1"><strong>EV Charging:</strong></p>
                                        <p class="mb-1"><strong>Public Transit:</strong></p>
                                        <p class="mb-1"><strong>Waste Recycling:</strong></p>
                                    </div>
                                    <div class="col-6 text-end">
                                        <p class="mb-1">45%</p>
                                        <p class="mb-1">5.1 MW</p>
                                        <p class="mb-1">62 Stations</p>
                                        <p class="mb-1">Limited</p>
                                        <p class="mb-1">52%</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <a href="#" class="btn btn-outline-primary">View Full Report</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <div class="row">
                    <div class="col-12 text-center">
                        <a href="#" class="btn btn-primary">Generate Custom Sustainability Report</a> {# Placeholder link #}
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="historical-content" role="tabpanel" aria-labelledby="historical-tab">
                <div class="row mb-4">
                    <div class="col-lg-8 mx-auto text-center">
                        <h3>Historical Hazardous Events</h3>
                        <p class="lead text-muted">Comprehensive database of past environmental and infrastructure events with impact analysis and response evaluation.</p>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-lg-4 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Event Filters</h5>
                                
                                <div class="mb-3">
                                    <label class="form-label">Event Type</label>
                                    <select class="form-select" id="event-type">
                                        <option value="all">All Events</option>
                                        <option value="flood">Flooding</option>
                                        <option value="fire">Fire</option>
                                        <option value="infrastructure">Infrastructure Failure</option>
                                        <option value="storm">Severe Weather</option>
                                        <option value="environmental">Environmental Incident</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Time Period</label>
                                    <select class="form-select" id="event-period">
                                        <option value="5">Last 5 Years</option>
                                        <option value="10">Last 10 Years</option>
                                        <option value="20">Last 20 Years</option>
                                        <option value="all">All Recorded History</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Severity</label>
                                    <select class="form-select" id="event-severity">
                                        <option value="all">All Severity Levels</option>
                                        <option value="critical">Critical</option>
                                        <option value="major">Major</option>
                                        <option value="moderate">Moderate</option>
                                        <option value="minor">Minor</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Location</label>
                                    <select class="form-select" id="event-location">
                                        <option value="all">All Locations</option>
                                        <option value="downtown">Downtown</option>
                                        <option value="north">North District</option>
                                        <option value="east">East Side</option>
                                        <option value="west">West End</option>
                                        <option value="south">South Quarter</option>
                                        <option value="industrial">Industrial Zone</option>
                                    </select>
                                </div>
                                
                                <button class="btn btn-primary w-100" id="apply-event-filters">Apply Filters</button>
                                <button class="btn btn-outline-secondary w-100 mt-2" id="reset-event-filters">Reset</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Historical Events Timeline</h5>
                                
                                <div class="timeline mt-4">
                                    <div class="card mb-3 border-danger">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <h5 class="card-title mb-0">Downtown Flooding</h5>
                                                <span class="badge bg-danger">Critical</span>
                                            </div>
                                            <h6 class="card-subtitle mb-2 text-muted">June 15, 2023 | Downtown District</h6>
                                            <p class="card-text">Severe flooding affected 60% of the downtown area following unprecedented rainfall, causing significant damage to infrastructure and businesses.</p>
                                            <div class="row mt-3">
                                                <div class="col-md-4">
                                                    <p class="mb-1"><strong>Economic Impact:</strong></p>
                                                    <p class="mb-1"><strong>Recovery Time:</strong></p>
                                                    <p class="mb-1"><strong>Response Rating:</strong></p>
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-1 risk-high">$42.5 Million</p>
                                                    <p class="mb-1">8 Months</p>
                                                    <p class="mb-1">Adequate (3/5)</p>
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <a href="#" class="btn btn-sm btn-outline-primary">View Detailed Report</a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="card mb-3 border-warning">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <h5 class="card-title mb-0">Industrial Zone Fire</h5>
                                                <span class="badge bg-warning text-dark">Major</span>
                                            </div>
                                            <h6 class="card-subtitle mb-2 text-muted">August 3, 2022 | Industrial Zone</h6>
                                            <p class="card-text">Fire at a manufacturing facility spread to adjacent properties, requiring evacuation of surrounding areas and causing air quality concerns.</p>
                                            <div class="row mt-3">
                                                <div class="col-md-4">
                                                    <p class="mb-1"><strong>Economic Impact:</strong></p>
                                                    <p class="mb-1"><strong>Recovery Time:</strong></p>
                                                    <p class="mb-1"><strong>Response Rating:</strong></p>
                                                </div>
                                                <div class="col-md-8">
                                                    <p class="mb-1 risk-medium">$18.7 Million</p>
                                                    <p class="mb-1">5 Months</p>
                                                    <p class="mb-1">Good (4/5)</p>
                                                </div>
                                            </div>
                                            <div class="mt-3">
                                                <a href="#" class="btn btn-sm btn-outline-primary">View Detailed Report</a>
                                            </div>
                                        </div>
                                    </div>
                                   
                                </div>
                                
                                <div class="text-center mt-4">
                                    <button class="btn btn-outline-primary">Load More Events</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-pane fade" id="projections-content" role="tabpanel" aria-labelledby="projections-tab">
                <div class="row mb-4">
                    <div class="col-lg-8 mx-auto text-center">
                        <h3>Future Risk Projections</h3>
                        <p class="lead text-muted">Data-driven forecasts of environmental risks, infrastructure vulnerabilities, and sustainability trends for urban planning.</p>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h4 class="card-title">Climate Impact Projections</h4>
                                <p class="card-text">Projected changes in temperature, precipitation, and extreme weather events over the next 30 years.</p>
                                
                                <div class="chart-container mt-4">
                                    <canvas id="climateChart" height="250"></canvas>
                                </div>
                                
                                <div class="mt-4">
                                    <h6>Key Findings:</h6>
                                    <ul>
                                        <li>Projected 2.3°C temperature increase by 2050</li>
                                        <li>15% increase in annual precipitation with more extreme rainfall events</li>
                                        <li>30% increase in days exceeding 32°C (90°F)</li>
                                        <li>Significant implications for infrastructure, energy demand, and public health</li>
                                    </ul>
                                </div>
                                
                                <div class="text-end mt-3">
                                    <a href="#" class="btn btn-outline-primary">View Detailed Projections</a> {# Placeholder link #}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h4 class="card-title">Infrastructure Vulnerability Forecast</h4>
                                <p class="card-text">Projected infrastructure vulnerabilities and failure risks based on current conditions and climate projections.</p>
                                
                                <div class="chart-container mt-4">
                                    <canvas id="infrastructureChart" height="250"></canvas>
                                </div>
                                
                                <div class="mt-4">
                                    <h6>Key Findings:</h6>
                                    <ul>
                                        <li>35% of stormwater infrastructure projected to be inadequate by 2040</li>
                                        <li>Electrical grid capacity challenges during peak demand periods</li>
                                        <li>Transportation infrastructure vulnerable to increased flooding and heat stress</li>
                                        <li>Significant investment required to maintain resilience standards</li>
                                    </ul>
                                </div>
                                
                                <div class="text-end mt-3">
                                    <a href="#" class="btn btn-outline-primary">View Detailed Projections</a> {# Placeholder link #}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">District Risk Evolution (2025-2050)</h4>
                                <p class="card-text">Projected changes in overall risk profiles by district over the next 25 years based on current trends and mitigation efforts.</p>
                                
                                <div class="table-responsive mt-4">
                                    <table class="table table-bordered">
                                        <thead class="table-light">
                                            <tr>
                                                <th>District</th>
                                                <th>Current Risk (2025)</th>
                                                <th>5-Year Projection (2030)</th>
                                                <th>15-Year Projection (2040)</th>
                                                <th>25-Year Projection (2050)</th>
                                                <th>Key Vulnerabilities</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Downtown</td>
                                                <td class="risk-medium">Medium (60%)</td>
                                                <td class="risk-medium">Medium (65%)</td>
                                                <td class="risk-high">High (72%)</td>
                                                <td class="risk-high">High (78%)</td>
                                                <td>Flooding, Infrastructure Age, Heat Island Effect</td>
                                            </tr>
                                            <tr>
                                                <td>North District</td>
                                                <td class="risk-low">Low (35%)</td>
                                                <td class="risk-low">Low (38%)</td>
                                                <td class="risk-medium">Medium (52%)</td>
                                                <td class="risk-medium">Medium (58%)</td>
                                                <td>Wildland Interface, Water Supply</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="alert alert-info mt-4">
                                    <i class="bi bi-info-circle me-2"></i> Projections are based on current climate models, infrastructure conditions, and planned mitigation efforts. Regular updates are recommended as new data becomes available.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12 text-center">
                        <a href="#" class="btn btn-primary">Generate Custom Projection Report</a> {# Placeholder link #}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize hazard map
        const hazardMapElement = document.getElementById('hazard-map');
        if (hazardMapElement) {
            const hazardMap = L.map('hazard-map').setView([40.7128, -74.0060], 13); // Example coordinates (New York)
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(hazardMap);
            
            // Sample hazard zones (would be loaded dynamically in a real application)
            L.circle([40.7128, -74.0060], { color: '#FF3B30', fillColor: '#FF3B30', fillOpacity: 0.5, radius: 500 }).addTo(hazardMap).bindPopup('High Flood Risk Zone - Downtown');
            L.circle([40.6950, -74.0000], { color: '#FF9500', fillColor: '#FF9500', fillOpacity: 0.5, radius: 700 }).addTo(hazardMap).bindPopup('Medium Flood Risk Zone - South Quarter');
            
            hazardMap.on('click', function() {
                const areaAnalysisElement = document.getElementById('area-analysis');
                if (areaAnalysisElement) areaAnalysisElement.style.display = 'block';
            });
        }

        // Hazard filter buttons
        const applyHazardFilters = document.getElementById('apply-hazard-filters');
        if (applyHazardFilters) {
            applyHazardFilters.addEventListener('click', function() {
                alert('Filters applied! This would update the hazard map with filtered data.');
            });
        }
        const resetHazardFilters = document.getElementById('reset-hazard-filters');
        if (resetHazardFilters) {
            resetHazardFilters.addEventListener('click', function() {
                // Reset logic here
                ['flood-hazard', 'fire-hazard', 'earthquake-hazard', 'pollution-hazard', 'infrastructure-hazard'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.checked = true;
                });
                const riskLevelEl = document.getElementById('risk-level');
                if (riskLevelEl) riskLevelEl.value = 'all';
                const timePeriodEl = document.getElementById('time-period');
                if (timePeriodEl) timePeriodEl.value = 'current';
            });
        }

        // Climate Impact Projections Chart
        const climateCtx = document.getElementById('climateChart');
        if (climateCtx) {
            new Chart(climateCtx.getContext('2d'), {
                type: 'line',
                data: { /* ... chart data as in original ... */ 
                    labels: ['2025', '2030', '2035', '2040', '2045', '2050'],
                    datasets: [
                        { label: 'Average Temperature (°C)', data: [15.2, 15.8, 16.4, 16.9, 17.3, 17.5], borderColor: '#FF3B30', backgroundColor: 'rgba(255, 59, 48, 0.1)', tension: 0.3, fill: true },
                        { label: 'Annual Precipitation (% change)', data: [0, 3, 6, 9, 12, 15], borderColor: '#4A90E2', backgroundColor: 'rgba(74, 144, 226, 0.1)', tension: 0.3, fill: true },
                        { label: 'Extreme Weather Events (per year)', data: [3, 4, 5, 6, 7, 8], borderColor: '#FF9500', backgroundColor: 'rgba(255, 149, 0, 0.1)', tension: 0.3, fill: true }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false /* ... other options ... */ }
            });
        }
        
        // Infrastructure Vulnerability Chart
        const infraCtx = document.getElementById('infrastructureChart');
        if (infraCtx) {
            new Chart(infraCtx.getContext('2d'), {
                type: 'bar',
                data: { /* ... chart data as in original ... */ 
                    labels: ['Stormwater', 'Electrical', 'Transportation', 'Water Supply', 'Buildings'],
                    datasets: [
                        { label: 'Current Vulnerability (%)', data: [25, 30, 20, 15, 35], backgroundColor: '#4A90E2' },
                        { label: '2040 Projected Vulnerability (%)', data: [35, 45, 30, 25, 50], backgroundColor: '#FF9500' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false /* ... other options ... */ }
            });
        }
        
        // Event filters
        const applyEventFilters = document.getElementById('apply-event-filters');
        if(applyEventFilters) {
            applyEventFilters.addEventListener('click', function() {
                alert('Filters applied! This would update the historical events list.');
            });
        }
        const resetEventFilters = document.getElementById('reset-event-filters');
        if(resetEventFilters) {
            resetEventFilters.addEventListener('click', function() {
                // Reset logic here
                const eventTypeEl = document.getElementById('event-type');
                if (eventTypeEl) eventTypeEl.value = 'all';
                const eventPeriodEl = document.getElementById('event-period');
                if (eventPeriodEl) eventPeriodEl.value = '5';
                const eventSeverityEl = document.getElementById('event-severity');
                if (eventSeverityEl) eventSeverityEl.value = 'all';
                const eventLocationEl = document.getElementById('event-location');
                if (eventLocationEl) eventLocationEl.value = 'all';
            });
        }
    });
</script>
{% endblock %}
